# nixpacks.toml

[phases.setup]
nixPkgs = ["python3"] # Install Python executable via Nix

[phases.install]
# Explicitly create the virtual environment, activate it,
# install numpy first, and then install crossroad-cli and its other dependencies,
# disabling build isolation for the installation process.
commands = [
  "python3 -m venv /opt/venv && . /opt/venv/bin/activate && pip install numpy && pip install --no-build-isolation crossroad-cli",
]

[start]
# Activate the virtual environment before starting the server
# to ensure executables like uvicorn are found within the venv.
cmd = ". /opt/venv/bin/activate && uvicorn crossroad.api.main:app --host 0.0.0.0 --port $PORT --workers 1"