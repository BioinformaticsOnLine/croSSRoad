# nixpacks.toml

[phases.setup]
nixPkgs = ["python3"] # Install Python executable via Nix

[phases.install]
# Explicitly create the virtual environment, activate it,
# and then install your Python dependencies.
commands = [
  "python3 -m venv /opt/venv", # Create the virtual environment
  ". /opt/venv/bin/activate && pip install crossroad-cli", # Activate and install using pip
]
[start]
# Activate the virtual environment before starting the server
# to ensure executables like uvicorn are found within the venv.
cmd = ". /opt/venv/bin/activate && uvicorn crossroad.api.main:app --host 0.0.0.0 --port $PORT --workers 1"